<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Flask Form with Tailwind and Network Graph</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
    ></script>
    <style>
      #network {
        width: 100%;
        height: 400px;
        border: 1px solid lightgray;
        margin-top: 20px;
      }
    </style>
  </head>
  <body class="bg-gray-100 flex items-center justify-center h-screen">
    <div class="bg-white p-8 rounded-lg shadow-lg w-1/3">
      <h2 class="text-2xl font-bold mb-6 text-center">Search Form</h2>
      <form method="POST" action="/" class="space-y-4">
        <div>
          <label for="input1" class="block text-sm font-medium text-gray-700"
            >Input 1</label
          >
          <input
            type="text"
            name="input1"
            id="input1"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
          />
          <div
            id="suggestions1"
            class="border border-gray-300 rounded-md mt-1 bg-white shadow-md hidden"
          ></div>
        </div>
        <div>
          <label for="input2" class="block text-sm font-medium text-gray-700"
            >Input 2</label
          >
          <input
            type="text"
            name="input2"
            id="input2"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
          />
          <div
            id="suggestions2"
            class="border border-gray-300 rounded-md mt-1 bg-white shadow-md hidden"
          ></div>
        </div>
        <div>
          <label for="dropdown" class="block text-sm font-medium text-gray-700"
            >Dropdown</label
          >
          <select
            name="dropdown"
            id="dropdown"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
          >
            <option value="option1">Option 1</option>
            <option value="option2">Option 2</option>
            <option value="option3">Option 3</option>
          </select>
        </div>
        <div class="text-center">
          <button
            type="submit"
            class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
          >
            Search
          </button>
        </div>
      </form>

      <!-- Network Graph Container -->
      <div id="network"></div>
    </div>

    <script>
      $(document).ready(function () {
        // Live suggestions for input1
        $("#input1").on("input", function () {
          let query = $(this).val();
          if (query.length > 0) {
            $.ajax({
              url: "/suggest",
              method: "GET",
              data: { query: query },
              success: function (data) {
                let suggestionsBox = $("#suggestions1");
                suggestionsBox.empty();
                if (data.length > 0) {
                  data.forEach(function (item) {
                    suggestionsBox.append(
                      "<div class='p-2 hover:bg-gray-200 cursor-pointer'>" +
                        item +
                        "</div>"
                    );
                  });
                  suggestionsBox.removeClass("hidden");
                } else {
                  suggestionsBox.addClass("hidden");
                }
              },
            });
          } else {
            $("#suggestions1").addClass("hidden");
          }
        });

        $(document).on("click", "#suggestions1 div", function () {
          $("#input1").val($(this).text());
          $("#suggestions1").addClass("hidden");
        });

        // Live suggestions for input2
        $("#input2").on("input", function () {
          let query = $(this).val();
          if (query.length > 0) {
            $.ajax({
              url: "/suggest2",
              method: "GET",
              data: { query: query },
              success: function (data) {
                let suggestionsBox = $("#suggestions2");
                suggestionsBox.empty();
                if (data.length > 0) {
                  data.forEach(function (item) {
                    suggestionsBox.append(
                      "<div class='p-2 hover:bg-gray-200 cursor-pointer'>" +
                        item +
                        "</div>"
                    );
                  });
                  suggestionsBox.removeClass("hidden");
                } else {
                  suggestionsBox.addClass("hidden");
                }
              },
            });
          } else {
            $("#suggestions2").addClass("hidden");
          }
        });

        $(document).on("click", "#suggestions2 div", function () {
          $("#input2").val($(this).text());
          $("#suggestions2").addClass("hidden");
        });

        // Network Graph using Vis.js
        // Network Graph using Vis.js
        function drawNetworkGraph(nodesData, edgesData) {
          let nodes = new vis.DataSet(nodesData);
          let edges = new vis.DataSet(edgesData);

          let container = document.getElementById("network");
          let data = {
            nodes: nodes,
            edges: edges,
          };

          let options = {
            edges: {
              arrows: {
                to: {
                  enabled: true, // Enables arrows for directed edges
                  scaleFactor: 1.2, // Adjusts the size of the arrow
                },
              },
              color: {
                inherit: true, // Use the same color as the node
              },
              smooth: {
                type: "curvedCW", // Makes the edges slightly curved
              },
            },
            physics: {
              enabled: true, // Enables physics simulation
            },
          };

          let network = new vis.Network(container, data, options);
        }

        // Fetch adjacency matrix data from Flask
        $.ajax({
          url: "/get_adjacency_matrix",
          method: "GET",
          success: function (response) {
            let matrix = response.matrix;
            let labels = response.labels;
            let nodesData = [];
            let edgesData = [];
            console.log(labels);

            // Convert adjacency matrix to nodes and edges
            for (let i = 0; i < matrix.length; i++) {
              // Use the labels from the server instead of "Node X"
              nodesData.push({ id: i + 1, label: labels[i] });
              for (let j = 0; j < matrix[i].length; j++) {
                if (matrix[i][j] === 1 || matrix[i][j] === 2) {
                  let edge = { from: i + 1, to: j + 1 };
                  if (matrix[i][j] === 2) {
                    // Color the edge green if the value is 2
                    edge.color = { color: "red" };
                  }
                  edgesData.push(edge);
                }
              }
            }

            drawNetworkGraph(nodesData, edgesData);
          },
        });
      });
    </script>
  </body>
</html>
